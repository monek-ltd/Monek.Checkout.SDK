<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>SDK Dev Dashboard</title>
    <link rel="stylesheet" href="./index.css">
</head>
<body>
    <h1>Monek Checkout SDK</h1>

    <form id="test-form" action="/echo" method="POST">

        <!-- Cardholder Name -->
        <label>
            Name on Card
            <input type="text" name="billingName" autocomplete="cc-name" required />
        </label>

        <!-- Email -->
        <label>
            Email
            <input type="email" name="billingEmail" autocomplete="email" required />
        </label>

        <!-- Phone -->
        <label>
            Phone
            <input type="tel" name="billingPhone" autocomplete="tel" />
        </label>

        <!-- Address lines -->
        <label>
            Address Line 1
            <input type="text" name="billingAddress1" autocomplete="address-line1" required />
        </label>

        <label>
            Address Line 2
            <input type="text" name="billingAddress2" autocomplete="address-line2" />
        </label>

        <!-- City -->
        <label>
            City
            <input type="text" name="billingCity" autocomplete="address-level2" required />
        </label>

        <!-- Postcode -->
        <label>
            Postcode
            <input type="text" name="billingPostcode" autocomplete="postal-code" required />
        </label>

        <!-- Country (numeric code or ISO alpha-2, depending on your API) -->
        <label>
            Country
            <input type="text" name="billingCountry" placeholder="826" required />
        </label>

        <br />
        <hr />
        <br />

        <div class="toolbar">
            <button type="button" id="btn-light">Light</button>
            <button type="button" id="btn-dark">Dark</button>
            <button type="button" id="btn-brand">Custom</button>
        </div>

        <div id="sdk-container" style="border:1px dashed #ccc; padding:8px;" width="100%" height="120"></div>

        <br />
        <button type="submit">Pay</button>
    </form>

    <hr />

    <!-- The built SDK (IIFE). -->
    <script src="/monek-checkout.iife.js"></script>
    <script>
        (async function () {
            // ====== debug taps ======
            window.addEventListener('message', (evt) => {
                console.log('[PARENT RX]', evt.origin, evt.data);
            });
            console.log('[parent] origin =', window.location.origin);

            // ====== init SDK ======
            const PUBLIC_KEY = 'live_...'; // <-- set your dev key
            if (typeof window.Monek !== 'function') {
                console.error('Monek SDK not loaded');
                return;
            }
            const sdk = await window.Monek(PUBLIC_KEY);
            
            const formEl = document.getElementById('test-form');

            const STYLING_LIGHT = { theme: 'light' };
            const STYLING_DARK = { theme: 'dark' };
            const STYLING_BRAND = {
              theme: 'light', // start from light preset, then blast over it

              layout: {
                containerPadding: ['28px','32px','28px','32px'], // top right bottom left
                textAlign: 'center',
                buttonAlign: 'right',
              },

              core: {
                backgroundColor: '#230046',                    // deep purple
                textColor: '#F1FF52',                          // acid yellow
                fontFamily: 'Impact, "Arial Black", system-ui, sans-serif',
                borderRadius: 28,                              // number → px
              },

              inputs: {
                inputBackgroundColor: '#FFF5C7',               // pale lemon
                inputTextColor: '#230046',                     // match page bg for contrast
                inputBorderColor: '#FF00AA',                   // hot magenta
                inputBorderRadius: 24,                         // number → px
              },

              typography: {
                fontSize: 20,                                  // nice and chunky
              },

              // Power-user overrides (consumed by your iframe CSS)
              cssVars: {
                '--monek-input-focus': '#00E0FF',              // cyan focus ring
                '--monek-input-placeholder': '#FF00AA',        // magenta placeholder
                '--monek-input-height': '6px',                // taller tap target
                '--monek-shadow': '0 0 0 4px rgba(255,0,170,.15), 0 16px 48px rgba(35,0,70,.45)',
              },
            };

            const val = (name) => String(new FormData(formEl).get(name) ?? '');

        
            // keep current instance here
            let checkout = null;

            // build the options (only place you repeat config)
            const buildOptions = (stylingPreset) => ({
              frameUrl: 'https://checkout-js.monek.com/src/hostedFields/hosted-fields.html',
              callbacks: {
                getAmount: () => ({ value: 1000, currencyCode: '826' }),
                getDescription: () => 'goods',
                getCardholderDetails: () => ({
                  name:  val('billingName'),
                  email: val('billingEmail'),
                  HomePhone: val('billingPhone'),
                  billingAddress: {
                    addressLine1: val('billingAddress1'),
                    addressLine2: val('billingAddress2'),
                    city:         val('billingCity'),
                    postcode:     val('billingPostcode'),
                    country:      val('billingCountry'),
                  },
                }),
              },
              styling: stylingPreset,                    
              challenge: { display: 'popup', size: 'medium' },
              completion: {
                mode: 'client',
                onSuccess: (ctx, { redirect }) => redirect(`/thank-you?s=${encodeURIComponent(ctx.sessionId)}`),
                onError:   (ctx, { reenable }) => { reenable(); alert(ctx?.payment?.Message || 'Payment failed'); },
                onCancel:  (ctx, { reenable }) => reenable(),
              },
              intent: 'Purchase',
              order: 'Checkout',
              settlementType: 'Auto',
              storeCardDetails: false,
              cardEntry: 'ECommerce',
            });

            // mount with a given preset; destroys old instance first
            async function mountWithPreset(preset) {
              // clear container UI
              const container = document.querySelector('#sdk-container');
              container.innerHTML = '<div style="padding:8px;color:#666">Loading…</div>';

              if (checkout && typeof checkout.destroy === 'function') {
                try { checkout.destroy(); } catch {}
              }

              checkout = sdk.createComponent('checkout', buildOptions(preset));
              await checkout.mount('#sdk-container');
            }

            // initial mount
            await mountWithPreset(STYLING_LIGHT);

            // ====== Wire the toolbar buttons (live switch, no remount) ======
            document.getElementById('btn-light').addEventListener('click', () => 
            {
                document.documentElement.setAttribute('data-theme','light');
                mountWithPreset(STYLING_LIGHT);
            });
            document.getElementById('btn-dark').addEventListener('click',  () => {
                document.documentElement.setAttribute('data-theme','dark');
                mountWithPreset(STYLING_DARK);
            });
            document.getElementById('btn-brand').addEventListener('click', () => {
                document.documentElement.setAttribute('data-theme','light');
                mountWithPreset(STYLING_BRAND);
            });
        })();
    </script>
</body>
</html>
